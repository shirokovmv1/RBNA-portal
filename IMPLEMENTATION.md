# Реализация RBNA Portal

## Выполненные требования

### ✅ 1. Структура проекта
- Создана структура с папками `backend/` и `frontend/`
- Backend: Django + Django REST Framework
- Frontend: React + TypeScript

### ✅ 2. Модели данных (Backend)
Реализованы все требуемые модели:
- **User** - пользователи с ролями (ADMIN, TOP_MANAGER, FIN_MANAGER, SITE_MANAGER, PM)
- **Project** - объекты строительства с бюджетом, сроками, прогрессом, статусом ковенантов
- **Contractor** - подрядчики с оценкой надёжности, флагами рисков
- **Contract** - договоры между проектами и подрядчиками
- **CostItem** - статьи затрат с физическими объёмами и стоимостью
- **UnitRate** - единичные расценки
- **Payment** - платежи и денежные потоки
- **Report** - отчёты генподрядчика

### ✅ 3. API (Django REST Framework)
- REST API с CRUD операциями для всех сущностей
- Фильтрация по всем требуемым полям
- Экспорт в CSV для проектов, договоров, статей затрат, подрядчиков
- Специальные endpoints: alerts, details, export_csv

### ✅ 4. Seed данные
Скрипт `python manage.py seed_data` создаёт:
- 8 пользователей с разными ролями
- 8 подрядчиков (генподрядчики и подрядчики)
- 5 проектов разных типов
- 15+ договоров
- 30+ статей затрат
- Единичные расценки
- Платежи
- Отчёты генподрядчика

### ✅ 5. Frontend (React + TypeScript)
Реализованы все требуемые экраны:

#### Главная панель (TOP_MANAGER)
- Таблица проектов с колонками: название, тип, прогресс, бюджет (план/факт/контракт), отклонение, статус ковенантов
- Виджет алертов: просроченные проекты, перерасход, нарушение ковенантов
- Фильтры по типу проекта и статусу ковенантов
- Экспорт в CSV

#### Финансовая панель (FIN_MANAGER)
- Выбор проекта по ID
- Таблица договоров по проекту: подрядчик, суммы (план/контракт/оплачено), отклонение, статус
- Таблица статей затрат по выбранному договору: вид работ, единица, объёмы, стоимость, отклонения
- Блок отчётов генподрядчика: таблица с фильтрацией, возможность изменения статуса
- Экспорт в CSV

#### Панель проекта (SITE_MANAGER, PM)
- Основная информация: тип, прогресс, бюджет, сроки, статус ковенантов
- Блок подрядчиков проекта с показателями
- Блок статей затрат и физических объёмов
- Индикатор просрочки

#### Рейтинг подрядчиков
- Таблица подрядчиков: название, тип, квалификация, надёжность, отклонения, флаги рисков
- Фильтры по типу, налоговому риску, номинации свыше
- Детальная карточка подрядчика с проектами и договорами
- Экспорт в CSV

#### База единичных расценок
- Таблица расценок с фильтрацией
- CRUD операции (создание, редактирование, удаление)
- Фильтры по типу проекта и виду работ

### ✅ 6. RBAC модель
- Простая модель ролей без настоящей аутентификации (для прототипа)
- Селектор роли на странице входа
- Разграничение доступа по ролям:
  - ADMIN - всё
  - TOP_MANAGER - главная панель, рейтинг подрядчиков
  - FIN_MANAGER - финансовая панель
  - SITE_MANAGER - панель проекта
  - PM - панель проекта, единичные расценки

### ✅ 7. Фильтрация
Реализована фильтрация:
- Проекты: по типу, статусу ковенантов
- Договоры: по проекту, подрядчику, статусу
- Статьи затрат: по договору, виду работ
- Отчёты: по проекту, подрядчику, периоду, статусу
- Подрядчики: по типу, налоговому риску, номинации свыше
- Единичные расценки: по типу проекта, виду работ, единице измерения

### ✅ 8. Экспорт данных
Реализован экспорт в CSV:
- Проекты (`/api/projects/export_csv/`)
- Договоры (`/api/contracts/export_csv/`)
- Статьи затрат (`/api/cost-items/export_csv/`)
- Подрядчики (`/api/contractors/export_csv/`)

### ✅ 9. UX требования
- Чистый интерфейс без перегруза
- Фильтры на всех страницах где необходимо
- Цветовая индикация статусов (ковенанты, отклонения, риски)
- Навигация между страницами
- Адаптивная вёрстка

### ✅ 10. Open Book модуль
**НЕ реализован** (согласно требованиям)
- Модуль Open Book не содержит логики расчётов
- Можно добавить заготовки/интерфейсы на будущее, но без реализации алгоритмов

## Технические детали

### Backend
- Django 4.2.7
- Django REST Framework 3.14.0
- django-filter для фильтрации
- django-cors-headers для CORS
- SQLite для прототипа

### Frontend
- React 18.2.0
- TypeScript 5.3.3
- React Router 6.21.0
- Axios для HTTP запросов
- Context API для управления состоянием

## Документация

Созданы файлы:
- `README.md` - основная документация
- `QUICKSTART.md` - быстрый старт
- `PROJECT_STRUCTURE.md` - структура проекта
- `IMPLEMENTATION.md` - описание реализации

## Готовность к использованию

Проект готов к запуску и тестированию. Все основные функции реализованы, демо-данные загружаются автоматически через seed скрипт.
